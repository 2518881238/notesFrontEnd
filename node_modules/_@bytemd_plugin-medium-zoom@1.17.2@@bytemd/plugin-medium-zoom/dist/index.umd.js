(function(C,p){typeof exports=="object"&&typeof module!="undefined"?module.exports=p():typeof define=="function"&&define.amd?define(p):(C=typeof globalThis!="undefined"?globalThis:C||self,C.bytemdPluginMediumZoom=p())})(this,function(){"use strict";function C(a){let t;return{viewerEffect({markdownBody:d}){const l=[...d.querySelectorAll("img")].filter(s=>{var w,L;return((L=(w=a==null?void 0:a.filter)==null?void 0:w.call(a,s))!=null?L:!0)&&!s.closest("a")});l.length!==0&&(async()=>(t||(t=await Promise.resolve().then(()=>Q)),t.default(l,a)))()}}}/*! medium-zoom 1.0.6 | MIT License | https://github.com/francoischalifour/medium-zoom */var p=Object.assign||function(a){for(var t=1;t<arguments.length;t++){var d=arguments[t];for(var l in d)Object.prototype.hasOwnProperty.call(d,l)&&(a[l]=d[l])}return a},T=function(t){return t.tagName==="IMG"},U=function(t){return NodeList.prototype.isPrototypeOf(t)},x=function(t){return t&&t.nodeType===1},M=function(t){var d=t.currentSrc||t.src;return d.substr(-4).toLowerCase()===".svg"},Z=function(t){try{return Array.isArray(t)?t.filter(T):U(t)?[].slice.call(t).filter(T):x(t)?[t].filter(T):typeof t=="string"?[].slice.call(document.querySelectorAll(t)).filter(T):[]}catch{throw new TypeError(`The provided selector is invalid.
Expects a CSS selector, a Node element, a NodeList or an array.
See: https://github.com/francoischalifour/medium-zoom`)}},X=function(t){var d=document.createElement("div");return d.classList.add("medium-zoom-overlay"),d.style.background=t,d},K=function(t){var d=t.getBoundingClientRect(),l=d.top,s=d.left,w=d.width,L=d.height,z=t.cloneNode(),P=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,A=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0;return z.removeAttribute("id"),z.style.position="absolute",z.style.top=l+P+"px",z.style.left=s+A+"px",z.style.width=w+"px",z.style.height=L+"px",z.style.transform="",z},E=function(t,d){var l=p({bubbles:!1,cancelable:!1,detail:void 0},d);if(typeof window.CustomEvent=="function")return new CustomEvent(t,l);var s=document.createEvent("CustomEvent");return s.initCustomEvent(t,l.bubbles,l.cancelable,l.detail),s},D=function a(t){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},l=window.Promise||function(o){function n(){}o(n,n)},s=function(o){var n=o.target;if(n===I){y();return}v.indexOf(n)!==-1&&Y({target:n})},w=function(){if(!(H||!e.original)){var o=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0;Math.abs(B-o)>i.scrollOffset&&setTimeout(y,150)}},L=function(o){var n=o.key||o.keyCode;(n==="Escape"||n==="Esc"||n===27)&&y()},z=function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=o;if(o.background&&(I.style.background=o.background),o.container&&o.container instanceof Object&&(n.container=p({},i.container,o.container)),o.template){var m=x(o.template)?o.template:document.querySelector(o.template);n.template=m}return i=p({},i,n),v.forEach(function(u){u.dispatchEvent(E("medium-zoom:update",{detail:{zoom:c}}))}),c},P=function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return a(p({},i,o))},A=function(){for(var o=arguments.length,n=Array(o),m=0;m<o;m++)n[m]=arguments[m];var u=n.reduce(function(r,g){return[].concat(r,Z(g))},[]);return u.filter(function(r){return v.indexOf(r)===-1}).forEach(function(r){v.push(r),r.classList.add("medium-zoom-image")}),N.forEach(function(r){var g=r.type,h=r.listener,O=r.options;u.forEach(function(b){b.addEventListener(g,h,O)})}),c},V=function(){for(var o=arguments.length,n=Array(o),m=0;m<o;m++)n[m]=arguments[m];e.zoomed&&y();var u=n.length>0?n.reduce(function(r,g){return[].concat(r,Z(g))},[]):v;return u.forEach(function(r){r.classList.remove("medium-zoom-image"),r.dispatchEvent(E("medium-zoom:detach",{detail:{zoom:c}}))}),v=v.filter(function(r){return u.indexOf(r)===-1}),c},$=function(o,n){var m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return v.forEach(function(u){u.addEventListener("medium-zoom:"+o,n,m)}),N.push({type:"medium-zoom:"+o,listener:n,options:m}),c},ee=function(o,n){var m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return v.forEach(function(u){u.removeEventListener("medium-zoom:"+o,n,m)}),N=N.filter(function(u){return!(u.type==="medium-zoom:"+o&&u.listener.toString()===n.toString())}),c},q=function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=o.target,m=function(){var r={width:document.documentElement.clientWidth,height:document.documentElement.clientHeight,left:0,top:0,right:0,bottom:0},g=void 0,h=void 0;if(i.container)if(i.container instanceof Object)r=p({},r,i.container),g=r.width-r.left-r.right-i.margin*2,h=r.height-r.top-r.bottom-i.margin*2;else{var O=x(i.container)?i.container:document.querySelector(i.container),b=O.getBoundingClientRect(),_=b.width,re=b.height,ie=b.left,ae=b.top;r=p({},r,{width:_,height:re,left:ie,top:ae})}g=g||r.width-i.margin*2,h=h||r.height-i.margin*2;var S=e.zoomedHd||e.original,de=M(S)?g:S.naturalWidth||g,me=M(S)?h:S.naturalHeight||h,j=S.getBoundingClientRect(),le=j.top,ue=j.left,W=j.width,F=j.height,ce=Math.min(de,g)/W,se=Math.min(me,h)/F,k=Math.min(ce,se),fe=(-ue+(g-W)/2+i.margin+r.left)/k,ge=(-le+(h-F)/2+i.margin+r.top)/k,R="scale("+k+") translate3d("+fe+"px, "+ge+"px, 0)";e.zoomed.style.transform=R,e.zoomedHd&&(e.zoomedHd.style.transform=R)};return new l(function(u){if(n&&v.indexOf(n)===-1){u(c);return}var r=function _(){H=!1,e.zoomed.removeEventListener("transitionend",_),e.original.dispatchEvent(E("medium-zoom:opened",{detail:{zoom:c}})),u(c)};if(e.zoomed){u(c);return}if(n)e.original=n;else if(v.length>0){var g=v;e.original=g[0]}else{u(c);return}if(e.original.dispatchEvent(E("medium-zoom:open",{detail:{zoom:c}})),B=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,H=!0,e.zoomed=K(e.original),document.body.appendChild(I),i.template){var h=x(i.template)?i.template:document.querySelector(i.template);e.template=document.createElement("div"),e.template.appendChild(h.content.cloneNode(!0)),document.body.appendChild(e.template)}if(document.body.appendChild(e.zoomed),window.requestAnimationFrame(function(){document.body.classList.add("medium-zoom--opened")}),e.original.classList.add("medium-zoom-image--hidden"),e.zoomed.classList.add("medium-zoom-image--opened"),e.zoomed.addEventListener("click",y),e.zoomed.addEventListener("transitionend",r),e.original.getAttribute("data-zoom-src")){e.zoomedHd=e.zoomed.cloneNode(),e.zoomedHd.removeAttribute("srcset"),e.zoomedHd.removeAttribute("sizes"),e.zoomedHd.src=e.zoomed.getAttribute("data-zoom-src"),e.zoomedHd.onerror=function(){clearInterval(O),console.warn("Unable to reach the zoom image target "+e.zoomedHd.src),e.zoomedHd=null,m()};var O=setInterval(function(){e.zoomedHd.complete&&(clearInterval(O),e.zoomedHd.classList.add("medium-zoom-image--opened"),e.zoomedHd.addEventListener("click",y),document.body.appendChild(e.zoomedHd),m())},10)}else if(e.original.hasAttribute("srcset")){e.zoomedHd=e.zoomed.cloneNode(),e.zoomedHd.removeAttribute("sizes"),e.zoomedHd.removeAttribute("loading");var b=e.zoomedHd.addEventListener("load",function(){e.zoomedHd.removeEventListener("load",b),e.zoomedHd.classList.add("medium-zoom-image--opened"),e.zoomedHd.addEventListener("click",y),document.body.appendChild(e.zoomedHd),m()})}else m()})},y=function(){return new l(function(o){if(H||!e.original){o(c);return}var n=function m(){e.original.classList.remove("medium-zoom-image--hidden"),document.body.removeChild(e.zoomed),e.zoomedHd&&document.body.removeChild(e.zoomedHd),document.body.removeChild(I),e.zoomed.classList.remove("medium-zoom-image--opened"),e.template&&document.body.removeChild(e.template),H=!1,e.zoomed.removeEventListener("transitionend",m),e.original.dispatchEvent(E("medium-zoom:closed",{detail:{zoom:c}})),e.original=null,e.zoomed=null,e.zoomedHd=null,e.template=null,o(c)};H=!0,document.body.classList.remove("medium-zoom--opened"),e.zoomed.style.transform="",e.zoomedHd&&(e.zoomedHd.style.transform=""),e.template&&(e.template.style.transition="opacity 150ms",e.template.style.opacity=0),e.original.dispatchEvent(E("medium-zoom:close",{detail:{zoom:c}})),e.zoomed.addEventListener("transitionend",n)})},Y=function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=o.target;return e.original?y():q({target:n})},te=function(){return i},oe=function(){return v},ne=function(){return e.original},v=[],N=[],H=!1,B=0,i=d,e={original:null,zoomed:null,zoomedHd:null,template:null};Object.prototype.toString.call(t)==="[object Object]"?i=t:(t||typeof t=="string")&&A(t),i=p({margin:0,background:"#fff",scrollOffset:40,container:null,template:null},i);var I=X(i.background);document.addEventListener("click",s),document.addEventListener("keyup",L),document.addEventListener("scroll",w),window.addEventListener("resize",y);var c={open:q,close:y,toggle:Y,update:z,clone:P,attach:A,detach:V,on:$,off:ee,getOptions:te,getImages:oe,getZoomedImage:ne};return c};function G(a,t){t===void 0&&(t={});var d=t.insertAt;if(!(!a||typeof document=="undefined")){var l=document.head||document.getElementsByTagName("head")[0],s=document.createElement("style");s.type="text/css",d==="top"&&l.firstChild?l.insertBefore(s,l.firstChild):l.appendChild(s),s.styleSheet?s.styleSheet.cssText=a:s.appendChild(document.createTextNode(a))}}var J=".medium-zoom-overlay{position:fixed;top:0;right:0;bottom:0;left:0;opacity:0;transition:opacity .3s;will-change:opacity}.medium-zoom--opened .medium-zoom-overlay{cursor:pointer;cursor:zoom-out;opacity:1}.medium-zoom-image{cursor:pointer;cursor:zoom-in;transition:transform .3s cubic-bezier(.2,0,.2,1)!important}.medium-zoom-image--hidden{visibility:hidden}.medium-zoom-image--opened{position:relative;cursor:pointer;cursor:zoom-out;will-change:transform}";G(J);const Q=Object.freeze(Object.defineProperty({__proto__:null,default:D},Symbol.toStringTag,{value:"Module"}));return C});
